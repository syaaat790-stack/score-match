<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScoreMatch ‚Äî Live Sports & Chess</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        /* ========== GLOBAL ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        }

        :root {
            --bg: #0f172a;
            --card-bg: #1e293b;
            --card-alt: #1e2a38;
            --border: #334155;
            --text: #e2e8f0;
            --text-muted: #94a3b8;
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --success: #065f46;
            --success-light: #bbf7d0;
            --danger: #7f1d1d;
            --danger-light: #fecaca;
            --warning: #7c2d12;
            --warning-light: #fed7aa;
            --live-indicator: #ff4d6d;
            --live-pulse: #ff758f;
            --chess-time: #1d4ed8;
            --turn-yellow: #fbbf24;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* ========== UTILITIES ========== */
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        .fade-out { animation: fadeOut 0.3s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOut {
            to { opacity: 0; transform: translateY(-10px); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        /* ========== AUTH ========== */
        #auth-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            transition: opacity 0.4s, transform 0.4s;
        }

        .auth-box {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 32px;
            width: 100%;
            max-width: 420px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            position: relative;
        }

        .auth-box::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), #8b5cf6);
            border-radius: 16px 16px 0 0;
        }

        .auth-box h2 {
            text-align: center;
            margin-bottom: 24px;
            color: var(--text-muted);
            font-weight: 600;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        input {
            width: 100%;
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: white;
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        button {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s, background 0.2s;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }
        .btn-primary:hover:not(:disabled) {
            background: var(--primary-dark);
            opacity: 1;
        }
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        .btn-warning {
            background: #8b5cf6;
            color: white;
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .switch-form {
            text-align: center;
            margin-top: 16px;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .switch-form a {
            color: #60a5fa;
            text-decoration: none;
            font-weight: 500;
        }

        .email-status {
            margin-top: 6px;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .email-status.checking { background: var(--border); color: #cbd5e1; }
        .email-status.available { background: var(--success); color: var(--success-light); }
        .email-status.taken { background: var(--danger); color: var(--danger-light); }
        .email-status.warning { background: var(--warning); color: var(--warning-light); }

        /* ========== APP LAYOUT ========== */
        #app-container {
            display: none;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background: var(--card-bg);
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 1.4rem;
            font-weight: 700;
            color: #60a5fa;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-links {
            display: flex;
            gap: 24px;
        }

        .nav-link {
            color: var(--text-muted);
            text-decoration: none;
            font-weight: 500;
            padding: 6px 12px;
            border-radius: 6px;
            transition: color 0.2s, background 0.2s;
        }
        .nav-link.active, .nav-link:hover {
            color: white;
            background: var(--border);
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .notification-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.2rem;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }
        .notification-btn:hover {
            background: var(--border);
            color: white;
        }

        #user-display {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.2s;
        }
        #user-display:hover {
            transform: scale(1.05);
        }

        main {
            flex: 1;
            padding: 24px;
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
        }

        .greeting {
            font-size: 1.5rem;
            margin-bottom: 24px;
            color: #cbd5e1;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            color: #f87171;
            font-weight: 600;
            font-size: 1.2rem;
        }

        /* ========== MATCH CARDS ========== */
        #live-matches {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .match-card {
            background: var(--card-alt);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .match-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }
        .match-card.live::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 4px;
            background: var(--live-indicator);
            animation: pulse 2s infinite;
        }

        .match-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .match-side {
            flex: 1;
            text-align: left;
            font-weight: bold;
            font-size: 1.4rem;
        }
        .match-side.right {
            text-align: right;
        }

        .match-center {
            flex: 1.2;
            text-align: center;
        }

        .time {
            font-size: 1.1rem;
            font-weight: 600;
            color: #4ade80;
            background: rgba(74, 222, 128, 0.15);
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
        }

        .score {
            font-size: 1.6rem;
            font-weight: 800;
        }
        .home-score { color: #60a5fa; }
        .away-score { color: #f87171; }

        .match-teams {
            display: flex;
            justify-content: space-between;
            font-size: 0.95rem;
            color: #cbd5e1;
        }
        .match-teams .vs {
            color: var(--text-muted);
            margin: 0 6px;
        }

        /* Chess-specific */
        .chess-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .chess-info .time {
            background: var(--chess-time);
            color: white;
        }
        .chess-info .turn {
            font-size: 0.85rem;
            color: var(--turn-yellow);
            font-weight: 500;
        }
        .match-teams .chess {
            font-style: italic;
            color: var(--text);
        }

        /* ========== NOTIFICATIONS ========== */
        #notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .toast {
            background: #1e293b;
            color: white;
            padding: 14px 20px;
            border-radius: 10px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease-out, fadeOutLong 0.5s 4.5s forwards;
            border-left: 4px solid #3b82f6;
        }
        .toast.success { border-left-color: #10b981; }
        .toast.warning { border-left-color: #f59e0b; }
        .toast.error { border-left-color: #ef4444; }
        .toast.daily { 
            border-left-color: #8b5cf6; 
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeOutLong {
            from { opacity: 1; }
            to { opacity: 0; transform: translateX(100%); }
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 600px) {
            .nav-links { display: none; }
            main { padding: 16px; }
            .match-side { font-size: 1.2rem; }
            .score { font-size: 1.4rem; }
            .time { font-size: 1rem; padding: 3px 10px; }
            #notification-container { top: 70px; right: 10px; }
        }

        /* ========== LOADING ========== */
        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <!-- üîî Notification Container (Dynamic) -->
    <div id="notification-container"></div>

    <!-- üîê Authentication Screens -->
    <div id="auth-container">
        <div class="auth-box">
            <h2><i class="fas fa-lock"></i> Login to ScoreMatch</h2>

            <!-- Login Form -->
            <form id="login-form">
                <div class="form-group">
                    <label for="login-email">Email (Google only)</label>
                    <input type="email" id="login-email" placeholder="contoh@gmail.com" autocomplete="off">
                    <div id="login-email-status" class="email-status hidden"></div>
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button type="button" id="login-btn" class="btn-primary">Login</button>
                <div class="switch-form">
                    Belum punya akun? <a href="#" id="show-signup">Daftar Sekarang</a>
                </div>
            </form>

            <!-- Signup Form -->
            <form id="signup-form" class="hidden">
                <div class="form-group">
                    <label for="signup-name">Nama Lengkap</label>
                    <input type="text" id="signup-name" placeholder="John Doe">
                </div>
                <div class="form-group">
                    <label for="signup-email">Email (@gmail.com only)</label>
                    <input type="email" id="signup-email" placeholder="john@gmail.com">
                    <div id="signup-email-status" class="email-status hidden"></div>
                </div>
                <div class="form-group">
                    <label for="signup-password">Password</label>
                    <input type="password" id="signup-password" placeholder="Minimal 6 karakter">
                </div>
                <button type="button" id="signup-btn" class="btn-primary">Daftar</button>
                <div class="switch-form">
                    Sudah punya akun? <a href="#" id="show-login">Login di sini</a>
                </div>
            </form>

            <!-- OTP Form -->
            <form id="otp-form" class="hidden">
                <p id="otp-instruction" style="text-align:center; margin-bottom:16px; color:var(--text-muted);">
                    Masukkan kode verifikasi 6-digit
                </p>
                <div class="form-group">
                    <input type="text" id="otp-code" placeholder="______" maxlength="6" inputmode="numeric"
                        style="text-align:center; font-size:1.4rem; letter-spacing:8px;">
                    <div id="otp-status" class="email-status hidden"></div>
                </div>
                <button type="button" id="verify-otp-btn" class="btn-primary">Verifikasi Kode</button>
                <div class="switch-form">
                    <a href="#" id="back-to-login">‚Üê Kembali ke Login</a>
                </div>
            </form>
        </div>
    </div>

    <!-- üéÆ App Dashboard -->
    <div id="app-container">
        <header>
            <div class="logo"><i class="fas fa-trophy"></i> ScoreMatch</div>
            <nav class="nav-links">
                <a href="#" class="nav-link active" data-page="dashboard">Dashboard</a>
                <a href="#" class="nav-link" data-page="live">Live Score</a>
                <a href="#" class="nav-link" data-page="profile">Profil</a>
            </nav>
            <div class="user-actions">
                <button class="notification-btn" id="bell-btn"><i class="fas fa-bell"></i></button>
                <div id="user-display">A</div>
            </div>
        </header>

        <main>
            <div id="dashboard-page" class="page active">
                <h2 class="greeting">Halo, <span id="profile-name-display">User</span>!</h2>

                <div class="section-title">
                    <i class="fas fa-fire"></i> üî¥ LIVE MATCHES
                </div>

                <div id="live-matches">
                    <!-- Match cards will be injected here -->
                </div>
            </div>

            <div id="live-page" class="page hidden">
                <h2>Live Score Updates</h2>
                <p>Semua pertandingan real-time ada di halaman Dashboard.</p>
            </div>

            <div id="profile-page" class="page hidden">
                <h2>Profil Pengguna</h2>
                <div style="background:var(--card-bg); padding:20px; border-radius:12px; margin-top:16px;">
                    <div style="display:flex; align-items:center; gap:16px; margin-bottom:16px;">
                        <div id="profile-avatar" style="width:60px; height:60px; border-radius:50%; background:var(--primary); display:flex; align-items:center; justify-content:center; font-size:1.5rem; font-weight:bold;">A</div>
                        <div>
                            <div id="profile-name" style="font-size:1.3rem;">User Name</div>
                            <div id="profile-email" style="color:var(--text-muted);">user@gmail.com</div>
                        </div>
                    </div>
                    <button id="logout-btn" class="btn-danger">Keluar</button>
                    <button id="force-daily-update" class="btn-warning" style="margin-top:10px;">üîÅ Force Daily Update</button>
                </div>
            </div>
        </main>
    </div>

    <script>
        // ==============================
        // üîß ScoreMatch Core Module
        // ==============================
        const ScoreMatch = (function() {
            // DOM Cache
            const DOM = {
                authContainer: document.getElementById('auth-container'),
                appContainer: document.getElementById('app-container'),
                loginForm: document.getElementById('login-form'),
                signupForm: document.getElementById('signup-form'),
                otpForm: document.getElementById('otp-form'),
                loginEmail: document.getElementById('login-email'),
                loginPassword: document.getElementById('login-password'),
                signupName: document.getElementById('signup-name'),
                signupEmail: document.getElementById('signup-email'),
                signupPassword: document.getElementById('signup-password'),
                otpCode: document.getElementById('otp-code'),
                loginBtn: document.getElementById('login-btn'),
                signupBtn: document.getElementById('signup-btn'),
                verifyOtpBtn: document.getElementById('verify-otp-btn'),
                showSignupBtn: document.getElementById('show-signup'),
                showLoginBtn: document.getElementById('show-login'),
                backToLoginBtn: document.getElementById('back-to-login'),
                logoutBtn: document.getElementById('logout-btn'),
                userDisplay: document.getElementById('user-display'),
                profileNameDisplay: document.getElementById('profile-name-display'),
                profileName: document.getElementById('profile-name'),
                profileEmail: document.getElementById('profile-email'),
                profileAvatar: document.getElementById('profile-avatar'),
                liveMatchesContainer: document.getElementById('live-matches'),
                navLinks: document.querySelectorAll('.nav-link'),
                pages: document.querySelectorAll('.page'),
                notificationContainer: document.getElementById('notification-container'),
                forceDailyUpdateBtn: document.getElementById('force-daily-update')
            };

            // State
            let emailCheckTimeout = null;

            // ‚úÖ Utilities
            const Utils = {
                isGmail(email) {
                    return typeof email === 'string' && email.toLowerCase().endsWith('@gmail.com');
                },

                debounce(func, delay) {
                    return function(...args) {
                        clearTimeout(emailCheckTimeout);
                        emailCheckTimeout = setTimeout(() => func.apply(this, args), delay);
                    };
                },

                generateOTP() {
                    return Math.floor(100000 + Math.random() * 900000).toString();
                },

                showToast(message, type = 'info', duration = 5000) {
                    const toast = document.createElement('div');
                    toast.className = `toast ${type}`;
                    toast.innerHTML = `
                        <i class="fas fa-${type === 'success' ? 'check-circle' : 
                         type === 'error' ? 'times-circle' : 
                         type === 'warning' ? 'exclamation-triangle' : 
                         type === 'daily' ? 'sync-alt' : 'info-circle'}"></i>
                        <span>${message}</span>
                    `;
                    DOM.notificationContainer.appendChild(toast);

                    setTimeout(() => {
                        toast.style.animation = 'fadeOutLong 0.5s forwards';
                        setTimeout(() => {
                            if (toast.parentNode) toast.remove();
                        }, 500);
                    }, duration);
                },

                setButtonLoading(btn, loading = true) {
                    if (loading) {
                        btn.disabled = true;
                        btn.innerHTML = '<span class="loader"></span> Memproses...';
                    } else {
                        btn.disabled = false;
                        btn.textContent = btn.dataset.defaultText || 'Submit';
                    }
                }
            };

            // üóÉÔ∏è Storage Controller
            const Storage = {
                getUsers() {
                    return JSON.parse(localStorage.getItem('users') || '[]');
                },

                saveUsers(users) {
                    localStorage.setItem('users', JSON.stringify(users));
                },

                getCurrentUser() {
                    return JSON.parse(localStorage.getItem('currentUser') || 'null');
                },

                saveCurrentUser(user) {
                    localStorage.setItem('currentUser', JSON.stringify(user));
                },

                removeCurrentUser() {
                    localStorage.removeItem('currentUser');
                },

                getLastDailyUpdate() {
                    return localStorage.getItem('lastDailyUpdate');
                },

                setLastDailyUpdate() {
                    localStorage.setItem('lastDailyUpdate', Date.now().toString());
                }
            };

            // üîê Auth Controller
            const Auth = {
                init() {
                    // Setup demo users
                    if (Storage.getUsers().length === 0) {
                        Storage.saveUsers([
                            { name: "Admin ScoreMatch", email: "admin@gmail.com", password: "admin123" },
                            { name: "User Demo", email: "user@gmail.com", password: "user123" }
                        ]);
                    }

                    // Event Listeners
                    DOM.showSignupBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        DOM.loginForm.classList.add('hidden');
                        DOM.signupForm.classList.remove('hidden');
                        DOM.otpForm.classList.add('hidden');
                        DOM.loginEmailStatus.classList.add('hidden');
                    });

                    DOM.showLoginBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        DOM.signupForm.classList.add('hidden');
                        DOM.loginForm.classList.remove('hidden');
                        DOM.otpForm.classList.add('hidden');
                        DOM.signupEmailStatus.classList.add('hidden');
                    });

                    DOM.backToLoginBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        sessionStorage.clear();
                        DOM.otpForm.classList.add('hidden');
                        DOM.loginForm.classList.remove('hidden');
                    });

                    DOM.loginBtn.addEventListener('click', this.handleLogin);
                    DOM.signupBtn.addEventListener('click', this.handleSignup);
                    DOM.verifyOtpBtn.addEventListener('click', this.handleOTPVerify);
                    DOM.logoutBtn.addEventListener('click', this.handleLogout);

                    // Email input listeners
                    DOM.loginEmail.addEventListener('input', Utils.debounce(() => {
                        this.checkEmail(DOM.loginEmail.value.trim(), true);
                    }, 500));
                    DOM.signupEmail.addEventListener('input', Utils.debounce(() => {
                        this.checkEmail(DOM.signupEmail.value.trim(), false);
                    }, 500));

                    // Force daily update (debug)
                    DOM.forceDailyUpdateBtn?.addEventListener('click', () => {
                        localStorage.removeItem('lastDailyUpdate');
                        DailyUpdate.perform();
                        Utils.showToast('‚úÖ Daily update dipaksa dijalankan!', 'daily');
                    });
                },

                get loginEmailStatus() {
                    return document.getElementById('login-email-status');
                },
                get signupEmailStatus() {
                    return document.getElementById('signup-email-status');
                },
                get otpStatus() {
                    return document.getElementById('otp-status');
                },

                checkEmail(email, isLogin) {
                    const statusEl = isLogin ? this.loginEmailStatus : this.signupEmailStatus;
                    if (!email || email.length < 5) {
                        statusEl.classList.add('hidden');
                        return;
                    }

                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    const isValid = emailRegex.test(email);
                    const isGoogle = Utils.isGmail(email);

                    statusEl.classList.remove('hidden');
                    statusEl.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Memeriksa...';

                    if (!isValid) {
                        statusEl.className = 'email-status warning';
                        statusEl.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Format email tidak valid';
                        return;
                    }

                    if (!isGoogle) {
                        statusEl.className = 'email-status warning';
                        statusEl.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Hanya @gmail.com yang diizinkan!';
                        return;
                    }

                    // Simulate API check
                    setTimeout(() => {
                        const users = Storage.getUsers();
                        const exists = users.some(u => u.email.toLowerCase() === email.toLowerCase());

                        if (isLogin) {
                            if (exists) {
                                statusEl.className = 'email-status available';
                                statusEl.innerHTML = '<i class="fas fa-check-circle"></i> Akun Google ditemukan';
                            } else {
                                statusEl.className = 'email-status taken';
                                statusEl.innerHTML = '<i class="fas fa-times-circle"></i> Akun tidak terdaftar';
                            }
                        } else {
                            if (exists) {
                                statusEl.className = 'email-status taken';
                                statusEl.innerHTML = '<i class="fas fa-times-circle"></i> Email sudah terdaftar';
                            } else {
                                statusEl.className = 'email-status available';
                                statusEl.innerHTML = '<i class="fas fa-check-circle"></i> Email tersedia';
                            }
                        }
                    }, 300);
                },

                handleLogin() {
                    const email = DOM.loginEmail.value.trim();
                    const password = DOM.loginPassword.value.trim();

                    if (!email || !password) {
                        Utils.showToast('‚ùå Email dan password wajib diisi', 'error');
                        return;
                    }

                    if (!Utils.isGmail(email)) {
                        Utils.showToast('‚ùå Hanya akun @gmail.com yang diizinkan', 'error');
                        return;
                    }

                    const users = Storage.getUsers();
                    const user = users.find(u => 
                        u.email.toLowerCase() === email.toLowerCase() && 
                        u.password === password
                    );

                    if (!user) {
                        const registered = users.some(u => u.email.toLowerCase() === email.toLowerCase());
                        Utils.showToast(registered ? '‚ùå Password salah!' : '‚ùå Akun tidak ditemukan', 'error');
                        return;
                    }

                    // Simulate OTP
                    const otp = Utils.generateOTP();
                    console.log(`[DEBUG] OTP untuk ${email}: ${otp}`);
                    sessionStorage.setItem('pendingUser', JSON.stringify({ name: user.name, email: user.email }));
                    sessionStorage.setItem('expectedOtp', otp);

                    DOM.loginForm.classList.add('hidden');
                    DOM.otpForm.classList.remove('hidden');
                    document.getElementById('otp-instruction').textContent = `Kode verifikasi untuk ${user.email}: ${otp} (simulasi)`;
                    DOM.otpCode.value = '';
                    DOM.otpCode.focus();
                },

                handleSignup() {
                    const name = DOM.signupName.value.trim();
                    const email = DOM.signupEmail.value.trim();
                    const password = DOM.signupPassword.value.trim();

                    if (!name || !email || !password) {
                        Utils.showToast('‚ùå Semua field wajib diisi', 'error');
                        return;
                    }

                    if (password.length < 6) {
                        Utils.showToast('‚ö†Ô∏è Password minimal 6 karakter', 'warning');
                        return;
                    }

                    if (!Utils.isGmail(email)) {
                        Utils.showToast('‚ùå Hanya @gmail.com yang diizinkan', 'error');
                        return;
                    }

                    const users = Storage.getUsers();
                    if (users.some(u => u.email.toLowerCase() === email.toLowerCase())) {
                        Utils.showToast('‚ùå Email sudah terdaftar!', 'error');
                        return;
                    }

                    const otp = Utils.generateOTP();
                    console.log(`[DEBUG] OTP untuk daftar ${email}: ${otp}`);
                    sessionStorage.setItem('pendingSignup', JSON.stringify({ name, email, password }));
                    sessionStorage.setItem('expectedOtp', otp);

                    DOM.signupForm.classList.add('hidden');
                    DOM.otpForm.classList.remove('hidden');
                    document.getElementById('otp-instruction').textContent = `Kode verifikasi untuk ${email}: ${otp} (simulasi)`;
                    DOM.otpCode.value = '';
                    DOM.otpCode.focus();
                },

                handleOTPVerify() {
                    const inputOtp = DOM.otpCode.value.trim();
                    const expectedOtp = sessionStorage.getItem('expectedOtp');
                    const pendingUser = JSON.parse(sessionStorage.getItem('pendingUser') || 'null');
                    const pendingSignup = JSON.parse(sessionStorage.getItem('pendingSignup') || 'null');

                    if (!expectedOtp) {
                        Utils.showToast('‚è≥ Sesi kadaluarsa. Silakan login ulang.', 'error');
                        return;
                    }

                    if (inputOtp !== expectedOtp) {
                        Utils.showToast('‚ùå Kode OTP salah! Coba lagi.', 'error');
                        DOM.otpCode.value = '';
                        DOM.otpCode.focus();
                        return;
                    }

                    // Success
                    let user;
                    if (pendingSignup) {
                        const users = Storage.getUsers();
                        users.push(pendingSignup);
                        Storage.saveUsers(users);
                        user = { name: pendingSignup.name, email: pendingSignup.email };
                        sessionStorage.removeItem('pendingSignup');
                    } else if (pendingUser) {
                        user = pendingUser;
                        sessionStorage.removeItem('pendingUser');
                    }

                    Storage.saveCurrentUser(user);
                    App.show(user);
                    sessionStorage.removeItem('expectedOtp');
                    Utils.showToast('‚úÖ Login berhasil!', 'success');
                },

                handleLogout() {
                    Storage.removeCurrentUser();
                    sessionStorage.clear();
                    DOM.appContainer.classList.add('hidden');
                    DOM.authContainer.classList.remove('hidden');
                    DOM.authContainer.style.opacity = '1';
                    DOM.loginEmail.value = '';
                    DOM.loginPassword.value = '';
                    DOM.navLinks[0].click(); // Reset nav
                }
            };

            // üìÖ Daily Update Module
            const DailyUpdate = {
                perform() {
                    const now = Date.now();
                    const lastUpdate = Storage.getLastDailyUpdate();
                    const twentyFourHours = 24 * 60 * 60 * 1000;

                    const liveCount = document.querySelectorAll('.match-card.live').length;
                    if (liveCount === 0) return; // Skip if no live matches

                    if (!lastUpdate || (now - parseInt(lastUpdate)) >= twentyFourHours) {
                        const msg = `üìà Update harian: ${liveCount} pertandingan live hari ini!`;
                        Utils.showToast(msg, 'daily', 6000);
                        Storage.setLastDailyUpdate();
                        console.log('[DAILY UPDATE]', msg);
                    }
                }
            };

            // üéÆ App Controller
            const App = {
                init() {
                    // Navigation
                    DOM.navLinks.forEach(link => {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            const target = e.target.dataset.page;

                            DOM.navLinks.forEach(l => l.classList.remove('active'));
                            link.classList.add('active');

                            DOM.pages.forEach(page => page.classList.add('hidden'));
                            document.getElementById(`${target}-page`).classList.remove('hidden');
                        });
                    });

                    // Auto-refresh
                    setInterval(() => {
                        if (DOM.appContainer.classList.contains('hidden') === false) {
                            this.loadMatches();
                        }
                    }, 30000);

                    // Check login on load
                    const currentUser = Storage.getCurrentUser();
                    if (currentUser) {
                        this.show(currentUser);
                    }
                },

                show(user) {
                    const initial = user.name.charAt(0).toUpperCase();
                    DOM.userDisplay.textContent = initial;
                    DOM.profileAvatar.textContent = initial;
                    DOM.profileName.textContent = user.name;
                    DOM.profileEmail.textContent = user.email;
                    DOM.profileNameDisplay.textContent = user.name;

                    DOM.authContainer.style.opacity = '0';
                    setTimeout(() => {
                        DOM.authContainer.classList.add('hidden');
                        DOM.appContainer.classList.remove('hidden');
                        this.loadMatches();
                    }, 300);
                },

                loadMatches() {
                    DOM.liveMatchesContainer.innerHTML = '';

                    const matches = [
                        { home: "Manchester United", away: "Liverpool", homeScore: 2, awayScore: 1, time: "68'", live: true, sport: "football" },
                        { home: "Real Madrid", away: "Barcelona", homeScore: 1, awayScore: 3, time: "82'", live: true, sport: "football" },
                        { home: "Lakers", away: "Warriors", homeScore: 94, awayScore: 98, time: "Q4 2:18", live: true, sport: "basketball" },
                        { home: "Magnus Carlsen", away: "Hikaru Nakamura", time: "Move 42", turn: "Black to move", live: true, sport: "chess" },
                        { home: "Djokovic", away: "Alcaraz", homeScore: 2, awayScore: 1, time: "4th Set", live: true, sport: "tennis" }
                    ];

                    matches.forEach(match => {
                        const card = document.createElement('div');
                        card.className = `match-card ${match.live ? 'live' : ''}`;

                        let left, center, right;
                        if (match.sport === 'chess') {
                            left = `<span class="team chess">${match.home}</span>`;
                            right = `<span class="team chess">${match.away}</span>`;
                            center = `
                                <div class="chess-info">
                                    <div class="time">${match.time}</div>
                                    <div class="turn">${match.turn}</div>
                                </div>
                            `;
                        } else {
                            left = `<span class="score home-score">${match.homeScore}</span>`;
                            right = `<span class="score away-score">${match.awayScore}</span>`;
                            center = `<span class="time">${match.time}</span>`;
                        }

                        card.innerHTML = `
                            <div class="match-content">
                                <div class="match-side left">${left}</div>
                                <div class="match-center">${center}</div>
                                <div class="match-side right">${right}</div>
                            </div>
                            <div class="match-teams">
                                <span class="team home">${match.home}</span>
                                <span class="vs">‚Äì</span>
                                <span class="team away">${match.away}</span>
                            </div>
                        `;
                        DOM.liveMatchesContainer.appendChild(card);
                    });

                    // üîÅ Trigger daily update check
                    DailyUpdate.perform();
                }
            };

            // üöÄ Public API
            return {
                init() {
                    Auth.init();
                    App.init();
                    Utils.showToast('üëã Selamat datang di ScoreMatch!', 'info', 3000);
                }
            };
        })();

        // üß™ Run on DOM load
        document.addEventListener('DOMContentLoaded', () => {
            ScoreMatch.init();
        });
    </script>
</body>
</html>
